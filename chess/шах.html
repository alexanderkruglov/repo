<html>
<head>
    <title></title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
 <script src="js/jquery-ui.js" type="text/javascript"></script>
 <link rel="stylesheet" type="text/css" href="style.css">
<script>
$(document).ready(function(){
    CreateBoard();
    CreateChess();

    $('.block').on('click',function(){
        if ($(this).attr('color')==thisteam.current){
            SelectCell($(this));
            if ($selectedCell.attr('type')=='pawn'){
                PawnStep();
            }
          
        }
        else{
            if ($selectedCell != null){
                Move($(this));
            }
        }
    })
})
function CreateBoard(){
    var board = $('#board');
    for (var i = 0; i < 8; i++) {
        for (var j = 0; j < 8; j++) {
            if ((i % 2 == 0 && j % 2 == 0) || (i % 2 != 0 && j % 2 != 0)) {
                board.append ($('<div class="s_kl block"> </div>').attr("x",i).attr("y",j));
            } else {
                board.append ($('<div class="t_kl block"> </div>').attr("x",i).attr("y",j));
            }
        }
    }
}

function CreateChess(){
    var cell = $('.block');
    //нумеруем ячейки
    for (var i=0; i<cell.length; i++){
        cell.eq(i).attr('id',i);
    }
    //добавляем шахматы на доску
    for (var i = 0; i < 8; i++) {
        for (var j = 0; j < 8; j++) {
            //пешки
            if (i == 1) {
                AddFigure(i,j, '<img  src="figures/dark/Black_P.ico">','black','pawn');

            } else if (i == 6) {
                AddFigure (i,j, '<img src="figures/light/White_P.ico">','white','pawn');
            }
            //первый ряд черных
            if (i == 0){
                if (j == 0 || j == 7)  {
                    AddFigure(i,j, '<img src="figures/dark/Black_R.ico">','black','Rook');
                }
                else if (j == 1 || j == 6) {
                    AddFigure(i,j,'<img src="figures/dark/Black_N.ico">','black','Knight');
                }
                else if (j == 2 || j == 5) {
                    AddFigure (i, j, '<img src="figures/dark/Black_B.ico">','black','Bishop');
                }
                else if (j == 3) {
                    AddFigure (i, j, '<img src="figures/dark/Black_Q.ico">','black','Queen');
                } else if (j == 4) {
                    AddFigure(i,j,'<img src="figures/dark/Black_K.ico">','black','King');
                }
            }
            //ряд белых
            if (i == 7){
                if (j == 0 || j == 7)  {
                    AddFigure(i,j, '<img src="figures/light/White_R.ico">','white','Rook');
                }
                else if (j == 1 || j == 6) {
                    AddFigure(i,j,'<img src="figures/light/White_N.ico">','white','Knight');
                }
                else if (j == 2 || j == 5) {
                    AddFigure (i, j, '<img src="figures/light/White_B.ico">','white','Bishop');
                }
                else if (j == 3) {
                    AddFigure (i, j, '<img src="figures/light/White_Q.ico">','white','Queen');
                } else if (j == 4) {
                    AddFigure(i,j,'<img src="figures/light/White_K.ico">','white','King');
                }
            }
        }
    }
}
//вставка по координатам рисунка
function AddFigure (x,y,_figureType,_color,_type) {
    $('[x='+x+']'+'[y='+y+']').append(_figureType);
    $('[x='+x+']'+'[y='+y+']').attr('type',_type).attr('color',_color);
}

function IsCellEmpty(cell){
    if ($(cell).find('img').length == 0){
        return true;
    }
    else{
        return false;
    }
}

var thisteam = {
    white : 'white',
    black : 'black',
    current : 'white',
    enemy:  'black'
}
function ChangeTeam(){
    if (thisteam.current == 'white') {
        thisteam.current='black';
        thisteam.enemy='white';
    }
    else   {
        thisteam.current='white';
        thisteam.enemy='black';
    }
}

var $selectedCell;
var is_selected=false;

function SelectCell(cell){
    is_selected = true;
    DropAllowedStep();
    if( $selectedCell !=null){
        $selectedCell.toggleClass('active');
    }
    $selectedCell = cell;
    cell.toggleClass('active');
}
function Move(targetCell){
    if (targetCell.hasClass('allowedStep')) {
        targetCell.attr('color', $selectedCell.attr('color')).attr('type', $selectedCell.attr('type'))
	$(targetCell).append($selectedCell.find('img'));
        $selectedCell.removeAttr('color').removeAttr('type');
	  $selectedCell.find('img').length == 0;
       $selectedCell.toggleClass('active');
        $selectedCell = null;
         if (targetCell.hasClass('attack')){
           console.log(''); 
        }
        else {
            ChangeTeam();
        } 
        DropAllowedStep();
    }
}
function DropAllowedStep(){
    $('div').removeClass('allowedStep').removeClass('attack');
}


//пешка
function PawnStep(){
    if ($selectedCell.attr('color') == 'white') {

        if ($selectedCell.attr('x') == 6) {
            if ($('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' + $selectedCell.attr('y') + ']').find('img').length == 0){
            $('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' + $selectedCell.attr('y') + ']').addClass('allowedStep');
            }
        }
        // не выделяет для хода занятые клетки
        if ($('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' +  $selectedCell.attr('y') + ']').find('img').length == 0){
            $('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' + $selectedCell.attr('y') + ']').addClass('allowedStep');
        }

        //левая диагональ   \.
        if ( $('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' + ($selectedCell.attr('y')-1) + ']').attr('color')=='black') {
            $('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' + ($selectedCell.attr('y') - 1) + ']').addClass('allowedStep').addClass('attack');
        }
        //правая диагональ ./
        if ( $('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' + ($selectedCell.attr('y')-(-1)) + ']').attr('color')=='black') {
            $('[x=' + ($selectedCell.attr('x') - 1) + ']' + '[y=' + ($selectedCell.attr('y') - (-1)) + ']').addClass('allowedStep').addClass('attack');
        }
    }
//теперь для черных
    if($selectedCell.attr('color') == 'black') {
        if ($selectedCell.attr('x') == 1) {
            if ($('[x=' +($selectedCell.attr('x')-(-1))+ ']' + '[y=' + $selectedCell.attr('y') + ']').find('img').length == 0) {
            $('[x=' +($selectedCell.attr('x')-(-1))+ ']' + '[y=' + $selectedCell.attr('y') + ']').addClass('allowedStep');
            }
        }
        
        if ($('[x=' + ($selectedCell.attr('x') - (-1)) + ']' + '[y=' + $selectedCell.attr('y') + ']').find('img').length == 0) {
            $('[x=' + ($selectedCell.attr('x') - (-1)) + ']' + '[y=' + $selectedCell.attr('y') + ']').addClass('allowedStep');
        }
       
        if ( $('[x=' + ($selectedCell.attr('x') - (-1)) + ']' + '[y=' + ($selectedCell.attr('y')-1) + ']').attr('color')=='white') {
            $('[x=' + ($selectedCell.attr('x') - (-1)) + ']' + '[y=' + ($selectedCell.attr('y') - 1) + ']').addClass('allowedStep').addClass('attack');
        }

     
        if ( $('[x=' + ($selectedCell.attr('x') - (- 1)) + ']' + '[y=' + ($selectedCell.attr('y')-(-1)) + ']').attr('color')=='white') {
            $('[x=' + ($selectedCell.attr('x') - (-1)) + ']' + '[y=' + ($selectedCell.attr('y') - (-1)) + ']').addClass('allowedStep').addClass('attack');
        }
    }
}

    
</script>
</head>
<body>
<div id="board"></div>
</body>
</html>